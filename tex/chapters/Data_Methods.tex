\chapter{Problem Description}

\section{Available Data}
	{
		Our study region is a farm of over 800ha, which is located in western Switzerland. From REF-gregor we acquire satellite image data (section \ref{sec:s2_img_data}), yield maps of several cereals from 2017 to 2021 (section \ref{sec:yieldmapping_data}), and meteorological data (section \ref{sec:gather_data_to_pixel}).
	}

	\subsection{Sentinel 2 Satellite Image Data}{
		\label{sec:s2_img_data}
		\subsubsection*{General Information}{
			The European Space Agency (ESA) \footnote{REF: https://sentinel.esa.int/web/sentinel/missions/sentinel-2} freely distributes the high-quality images of the two Sentinel satellites 2 (S2). Together, both satellites have a revisit time of 5 days at the equator and 2-3 at mid-latitudes. However, in our study region, we only receive an image every 5 days.
			In order to decrease the effect of atmospheric conditions like reflections and scattering, we will not work with the raw data but with the results of the Level-2A processing\footnote{REF https://sentinels.copernicus.eu/web/sentinel/technical-guides/sentinel-2-msi/level-2a/algorithm}\footnote{XXXREF gregor perich ``Data prior to March 2018 was only145
			available in the top-of-atmosphere L1C format and was downloaded as such [...] L1C data was processed to L2A product level using the `Sen2Cor' processor provided by ESA''}. 
		}

		\subsubsection*{Data Description}{
			The Level-2A processed images we use contain 12 spectral bands with local resolutions up to 10 meters (see \ref{table:S2-bands}).   
			\input{tex/chapters/misc/table_S2-bands.tex}
			Bands which have a lower resolution (20 and 60 meters) will be scaled up to 10 meters using cubic interpolation (REF gregor perich).
							% \begin{figure}[h]
							% 	\label{fig:satelite/sentinel-2-bands}
							% 	\center
							% 	\includegraphics[width=0.4\textwidth]{satelite/sentinel-2-bands.jpg}
							% 	\caption{XXX Sentinel 2 bands}
							% \end{figure}
			Additional to the spectral bands, the ESA also supplies a Scene Classification Layer (\textit{SCL}) where for each location the observed subject is assigned to an \textit{SCL-class} (cf. table~\ref{tab:satelite/scl_classes}). In chapter \ref{sec:itpl}  we will use this classification to filter out unreliable data points, considering only SCL-classes 4 and 5.  
			
			
			\begin{table}[h]
				\caption{Overview: Scene Classification Layers (SCL)}
				\label{tab:satelite/scl_classes}
				\center
				\includegraphics[width=0.8\textwidth]{satelite/scl_classes.png}
			\end{table}
		}

		\subsubsection*{Data Illustration}{
			\input{tex/chapters/misc/2x3_satelite_ts_plot_grid.tex}
			% Description of plot
			The figure ~\ref{fig:witzwil_selected_satellite_images} shows a selection of 6 satellite images of a field, which display our challenges. In February (image(a)), as expected, we see no vegetation but bare soil. At the beginning of May, we observe a cloudless dark green field. In (c) it is obvious that we have no chance to get useful information when there is a heavy cloud cover. Figure (d) shows that the SCL classification is not reliable, since we evidently observe clouds. In (e) we see a pale green. This likely shimmers through cirrus clouds. 
			
			%% subfigures references:
			% (see. \ref{fig:satelite/time_series_2021_P112/15_scl5_2021-02-23.png})
			% (see. \ref{fig:satelite/time_series_2021_P112/30_scl4_2021-05-09.png})
			% (see. \ref{fig:satelite/time_series_2021_P112/33_scl9_2021-05-24.png})
			% (see. \ref{fig:satelite/time_series_2021_P112/35_scl4_2021-06-03.png})
			% (see. \ref{fig:satelite/time_series_2021_P112/40_scl10_2021-06-28.png})
			% (see. \ref{fig:satelite/time_series_2021_P112/45_scl2_2021-07-23.png})
		}
	}

	\subsection{Harvest Yield Data}{
		\label{sec:yieldmapping_data}
		The crop yield data were collected using a combine harvester. Equipped with GPS, the harvester drives over the fields and continuously estimates the crop density in $t/ha$ (see fig. \ref{fig:satelite/witzwil_2021_P112_yield_harvester_cropped}). 
		We take the data set derived from this in REF-Gregor-Perich, where error-prone measurement points (such as during an egen curve) were removed and then the yield map was rasterized using linear interpolation (cf. fig. \ref{fig:satelite/witzwil_2021_P112_yield_cropped.png}).    

		
		Comparing the manually weighted yield and the sum of estimated raster (per field per year) we note a discrepancy of about $10\%$ (cf. REF-gregor). Since the relative estimation error is rather constant and we do not aim to estimate the absolute yield we will not consider this deviation.
		\begin{figure}
			\centering
			\begin{subfigure}{.5\textwidth}
			  \centering
			  \includegraphics[height=.75\linewidth]{satelite/witzwil_2021_P112_yield_harvester_cropped.png}
			  \caption{obtained by a combine harvester (cleaned)}
			  \label{fig:satelite/witzwil_2021_P112_yield_harvester_cropped}
			\end{subfigure}%
			\begin{subfigure}{.5\textwidth}
				\centering
				\includegraphics[height=.75\linewidth]{satelite/witzwil_2021_P112_yield_cropped.png}
			  \caption{rasterized to Sentinel 2 resolution.}
			  \label{fig:satelite/witzwil_2021_P112_yield_cropped.png}
			\end{subfigure}
			\caption{Crop yield density map of a field. Ranges from 0.1 t/ha (black) to 5.35 t/ha (white) }
			\label{fig:satelite_witzwil_yield}
		\end{figure}
	}


	\subsection{Gather Data}{
		\label{sec:gather_data_to_pixel}
		Before we join all the data, we define a few concepts.

		{% NDVI
			Using bands $B4$ and $B8$, we calculate the well-known Normalized Difference Vegetation Index (\textit{NDVI}) using the formula: (???REF n√∂tig?)
			\begin{equation}
				NDVI = \frac{B8 - B4}{B8 + B4}
				\label{eq:ndvi}
			\end{equation}
			Note that we call the calculated values merely the \textit{observed NDVI}, as we must be aware of imprecisions due to clouds and shadows. 
		}

		{% GDD & DAS
			To define a timescale, we consider Days After Sowing (\textit{DAS}) and a transformed timescale, Growing Degree Days (\textit{GDD}) (\cite{mcmasterGrowingDegreedaysOne1997}). The latter are defined as the cumulative sum (since sowing) of temperature above a given base temperature $T_{base}$ \footnote{XXX For cereals we use $T_{base}=0$ }. Thus, the GGD for $n$ days after sowing will be equal to:
			\begin{equation}
				\label{eq:gdd}
				GDD_n := \sum_{i=0}^n \max(T_i - T_{base}, 0).
			\end{equation}
		} 

		Now we create a data set, which will contain all the necessary information. Given that we have the spectral data at a $10m \times 10m$ resolution, we introduce the concept of a Pixel. A \textit{Pixel} $P$ is associated with a $10m \times 10m$ square defined by the S2 satellites and contains all relevant information for a season and this location. More precisely, $P$ is a collection of general information (like yield and coordinates) and all associated $P_t$ of a given season. Where $P_t$ represents a tuple of the spectral data for time $t$, the NDVI calculated from it, and the associated GDD. 
		We will call the resulting data set \textit{PIXELS} as it is the collection of all Pixels (over all seasons). 
		
		Finally, we split PIXELS randomly into a train ($80\%$) and test  ($20\%$) set. 

	}

\section{General Methods}{
	We will only introduce general methods within this section, whereas more specific methods will be introduced in their context. We discuss interpolation methods in sections \ref{sec:itpl_parametric} and \ref{sec:itpl_nonparametric} , a robustification strategy in section \ref{sec:loess_robustify}, a method how we can objectively determine the quality of an interpolation in section \ref{sec:itpl_param_est}, and in section \ref{sec:corr_correction} we present the NDVI correction with an adapted interpolation strategy.

	\subsection{XXX Out-Of-Bag (\textit{OOB}) and Leave-One-Out-Cross-Validation (\textit{LOOCV})}{
		\label{sec:OOB_LOOCV}
	}
}
